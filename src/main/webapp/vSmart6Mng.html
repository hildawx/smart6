<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8">
    <meta charset="utf-8">
    <title>vSmart6</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta content="" name="description">
    <meta content="" name="author">
    <link href="assets/plugins/pace/pace-theme-flash.css" rel="stylesheet" type="text/css">
    <link href="assets/plugins/boostrapv3/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="assets/plugins/font-awesome/css/font-awesome.css" rel="stylesheet" type="text/css">
    <link href="assets/plugins/bootstrap3-wysihtml5/bootstrap3-wysihtml5.min.css" rel="stylesheet" type="text/css">
    <link href="assets/plugins/jquery-datatable/media/css/jquery.dataTables.css" rel="stylesheet" type="text/css">
    <link href="assets/plugins/jquery-datatable/extensions/FixedColumns/css/dataTables.fixedColumns.min.css" rel="stylesheet" type="text/css">
    <link href="assets/plugins/datatables-responsive/css/datatables.responsive.css" rel="stylesheet" type="text/css" media="screen">
    <link href="pages/css/pages-icons.css" rel="stylesheet" type="text/css">
    <link class="main-stylesheet" href="pages/css/pages.css" rel="stylesheet" type="text/css">
    <style>
    .table tbody tr td .btn {margin: 0;}
    .panel .panel-heading { border-bottom: 1px solid #8A7DBE;}
    .form-group label:not(.error) { font-size: 13px;}
    </style>
</head>

<body>

    <div class="container-fluid padding-25 sm-padding-10">
        <div class="panel panel-transparent">
            <div class="panel-heading">
                <div class="panel-title"> vSmart6设备列表</div>
                <div style="display:inline-block; margin-left: 20px;">
                    <label>Smart6设备：</label>
                    <select id="deviceSelect">
<!--                        <option value="192.168.1.1:1234">192.168.1.1:1234</option>
                        <option value="192.168.1.1:1234">192.168.1.211:5678</option>-->
                    </select>
                </div>
                <div class="pull-right">
                    <div class="col-xs-12">
                        <button class="btn btn-primary btn-cons" id="show-modal" data-toggle="modal" data-target="#addvSmart6Modal"><i class="fa fa-plus"></i> 创建vSmart6</button>
                    </div>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="panel-body">
                <div class="dataTables_wrapper form-inline no-footer">
                    <div class="table-responsive">
                        <table id="basicTable" class="table table-hover table-condensed dataTable no-footer">
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- 新建vSmart6设备弹窗 Start-->
        <div class="modal fade stick-up" id="addvSmart6Modal" tabindex="-1" role="dialog" aria-labelledby="addNewAppModal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header clearfix ">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="pg-close fs-14"></i></button>
                        <h4 class="p-b-5"> 新建vSmart6</h4>
                    </div>
                    <div class="modal-body">
                        <!-- <p class="small-text">Create a new app using this form, make sure you fill them all</p> -->
                        <form role="form">
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="form-group form-group-default">
                                        <label>vSmart6名称</label>
                                        <input id="cvSName" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button id="cEnter" type="button" class="btn btn-primary btn-cons" onClick="createvSmart6()"> 确定</button>
                        <button type="button" class="btn btn-cons" data-dismiss="modal"> 取消</button>
                    </div>
                </div>

            </div>
        </div>
        <!-- 新建vSmart6设备弹窗 End -->
        
        <!-- 下发配置弹窗 Start-->
        <div class="modal fade stick-up" id="configModal" tabindex="-1" role="dialog" aria-labelledby="addNewAppModal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header clearfix ">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="pg-close fs-14"></i>
                        </button>
                        <h4 class="p-b-5"> 下发配置</h4>
                    </div>
                    <div class="modal-body">
                        <!-- <p class="small-text">Create a new app using this form, make sure you fill them all</p> -->
                        <form role="form">
                            <div class="row hide">
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>vSmart6</label>
                                        <input id="hvSmart6Name" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>v6lanip</label>
                                        <input id="v6lanip" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>v6gateway</label>
                                        <input id="v6gateway" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>v4wanip</label>
                                        <input id="v4wanip" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>v4gateway</label>
                                        <input id="v4gateway" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>prefA_Len</label>
                                        <input id="prefA_Len" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>prefB_Len</label>
                                        <input id="prefB_Len" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>prefA_feature</label>
                                        <input id="prefA_feature" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>prefB_feature</label>
                                        <input id="prefB_feature" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>prefA_nat_start</label>
                                        <input id="prefA_nat_start" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>prefA_nat_end</label>
                                        <input id="prefA_nat_end" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>Every_Start_Port</label>
                                        <input id="Every_Start_Port" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>Port_Len</label>
                                        <input id="Port_Len" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>Baddr_pool</label>
                                        <input id="Baddr_pool" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>dns_proxy_mode</label>
                                        <input id="dns_proxy_mode" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-cons" onClick="configSubmit()"> 确定</button>
                        <button type="button" class="btn btn-cons" data-dismiss="modal"> 取消</button>
                    </div>
                </div>

            </div>
        </div>
        <!-- 下发配置弹窗 End -->
        
        <!-- 将vSmart6添加到备份组弹窗 Start-->
        <div class="modal fade stick-up" id="toClusterModal" tabindex="-1" role="dialog" aria-labelledby="addNewAppModal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header clearfix ">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="pg-close fs-14"></i>
                        </button>
                        <h4 class="p-b-5"> 将vSmart6添加到备份组</h4>
                    </div>
                    <div class="modal-body">
                        <!-- <p class="small-text">Create a new app using this form, make sure you fill them all</p> -->
                        <form role="form">
                            <div class="row hide">
                                <div class="col-sm-6">
                                    <div class="form-group form-group-default">
                                        <label>vSmart6</label>
                                        <input id="hvSmart6Name2" type="text" class="form-control" placeholder="">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-12">
                                    <div class="form-group form-group-default">
                                        <label>备份组</label>
                                        <select id="cluster" class="form-group">
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary btn-cons" onClick="toClusterSubmit()"> 确定</button>
                        <button type="button" class="btn btn-cons" data-dismiss="modal"> 取消</button>
                    </div>
                </div>

            </div>
        </div>
        <!-- 将vSmart6添加到备份组弹窗 End -->

        <!-- 流表查看弹窗 Start-->
        <div class="modal fade stick-up" id="viewFlowModal" tabindex="-1" role="dialog" aria-labelledby="addNewAppModal" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header clearfix ">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="pg-close fs-14"></i>
                        </button>
                        <h4 class="p-b-5">ICMP流表查看</h4>
                    </div>
                    <div class="modal-body">
                        <table id="flowTable" class="table table-hover table-condensed dataTable no-footer">
                        </table>
                    </div>
                    <!--<div class="modal-footer">
                        <button type="button" class="btn btn-cons" data-dismiss="modal">关闭</button>
                    </div>-->
                </div>

            </div>
        </div>
        <!-- 流表查看弹窗 End -->
    </div>

    <script src="assets/plugins/pace/pace.min.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
    <script src="assets/plugins/modernizr.custom.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
    <script src="assets/plugins/boostrapv3/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/plugins/bootstrap3-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
    <script type="text/javascript" src="assets/plugins/bootstrap-select2/select2.min.js"></script>
    <script src="assets/plugins/jquery-datatable/media/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery-datatable/extensions/TableTools/js/dataTables.tableTools.min.js" type="text/javascript"></script>
    <script src="assets/plugins/jquery-datatable/extensions/Bootstrap/jquery-datatable-bootstrap.js" type="text/javascript"></script>
    <script type="text/javascript" src="assets/plugins/datatables-responsive/js/datatables.responsive.js"></script>
    <script type="text/javascript" src="assets/plugins/datatables-responsive/js/lodash.min.js"></script>
    <script type="text/javascript" src="pages/js/common.js"></script>
    
    <script>
        
        var oTable;
        var fTable;
        
    // 创建vSmart6提交
    function createvSmart6(){
        var smart6 = $("#deviceSelect option:selected").val();
        var vSmart6Name = $("#cvSName").val();
        //console.log(smart6 + "-" + vSmart6Name);
        $.ajax({
           url:"smart6/vsmart6Add",
           data:{smart6:smart6,vSmart6Name:vSmart6Name},
           type:"POST",
           success:function(data){
               if(data == "true"){
                   $("#addvSmart6Modal").modal("hide");
               }else{
                   alert("添加失败");
               }
           },
           error:function(e){
               alert(e.message);
           }
        });
    }

    // 删除设备账号
    function deletevSmart6(name){
        var smart6 = $("#deviceSelect option:selected").val();
        var vSmart6Name = name;
//        console.log(name + "-" + vSmart6Name);
        $.ajax({
            url :"smart6/vsmart6Delete",
            data:{smart6:smart6,vSmart6Name:vSmart6Name},
            type:"POST",
            success:function(data){
                if(data == "true"){
                    alert("删除成功！");
                }else{
                    alert("删除失败！");
                }
            },
            error:function(e){
                alert(e.message);
            }
         });
    }
    
    // 查看流表弹窗 flag-查看流表类型，1代表ICMP，2代表TCP，3代表UDP，4代表userTB
    function viewFlow (name, flag) {
        $("#viewFlowModal").modal("show");
        $("#viewFlowModal").on("shown.bs.modal", function(e){
            var smart6 = $("#deviceSelect option:selected").val();;
            switch(flag) {
                case 1:
                    // ICPM流表
                    $("#viewFlowModal .modal-header h4").html("ICMP流表查看");
                    refreshICMPFlowTable(smart6, name);
                    break;
                case 2:
                    // TCP流表
                    $("#viewFlowModal .modal-header h4").html("TCP流表查看");
                    refreshTCPFlowTable(smart6, name);
                    break;
                case 3:
                    // UDP流表
                    $("#viewFlowModal .modal-header h4").html("UDP流表查看");
                    refreshUDPFlowTable(smart6, name);
                    break;
                case 4:
                    // userTB
                    $("#viewFlowModal .modal-header h4").html("userTB查看");
                    refreshUserTBFlowTable(smart6, name);
                    break;
            }
        });
    }
    
    // 刷新ICMP流表数据
    function refreshICMPFlowTable(smart6, vName){
        
        // window.location.reload();
        if(fTable){
            fTable.fnDestroy();
        }
        
        // jquery.dataTables.js
        fTable = $('#flowTable').dataTable({
            "bSort": false,
            "bLengthChange": false,
            "bFilter": false,
            "language": {
                "url": "pages/Chinese.json"
            },
            "bProcessing": true,
//            "sAjaxSource": "ajax/flow.txt?smart6="+smart6,
            "sAjaxSource": "smart6/icmpsearch?smart6="+smart6 + "&vSmart6Name=" + vName,
            "aoColumns":[
                {"sTitle": "sipv6", "width": "30%"},
                {"sTitle": "dipv6", "width": "30%"},
                {"sTitle": "sport", "width": "13%"},
                {"sTitle": "dport", "width": "13%"},
                {"sTitle": "naptport", "width": "14%"}
                /*{
                    "sTitle":"icmp",
                    "render":function(data,type,full,meta){
                        return '<a href="javascript:;" title="查看ICMP流表" onclick=viewFlow("' + full[0] + '")><i class="fa fa-search"></i> </a>';
                    }
                },
                {
                    "sTitle":"tcp",
                    "render":function(data,type,full,meta){
                        return '<a href="javascript:;" title="查看TCP流表" onclick=viewFlow("' + full[0] + '")><i class="fa fa-search"></i> </a>';
                    }
                },
                {
                    "sTitle":"udp",
                    "render":function(data,type,full,meta){
                        return '<a href="javascript:;" title="查看UDP流表" onclick=viewFlow("' + full[0] + '")><i class="fa fa-search"></i> </a>';
                    }
                },
                {
                    "sTitle":"userTb",
                    "render":function(data,type,full,meta){
                        return '<a href="javascript:;" title="查看userTB" onclick=viewFlow("' + full[0] + '")><i class="fa fa-search"></i> </a>';
                    }
                },
                {
                    "sTitle":"配置",
                    "render":function(data,type,full,meta){
                        return '<a href="javascript:;" title="查看配置" onclick=config("' + full[0] + '")><i class="fa fa-search"></i> </a>';
                    }
                },
                {
                    "sTitle": "操作",
                    "width":"100px",
                    "render": function(data,type,full,meta){
                        var name = full[0];
                        return '<a href="javascript:;" title="下发配置" onclick=config("' + name + '")><i class="fa fa-mail-forward"></i> </a>&nbsp;&nbsp;&nbsp;<a href="javascript:;" title="加入到备份组" onclick=addToCluster("' + name + '")><i class="fa fa-plus"></i> </a> &nbsp;&nbsp;&nbsp; <a href="javascript:;" title="删除" onclick=deletevSmart6("' + name + '")><i class="fa fa-trash-o"></i> </a>';
                    }
                }*/
            ],
            /*fnServerData:function(sUrl, aoData, fnCallback, oSettings){
                oSettings.jqXHR = $.ajax({
                    "url": sUrl,
//                    "data": aoData,
//                    "type":"POST",
                    "dataType": "json",
                    "cache": false,
                    "success": function(data){
                        $.each(data.aaData,function(i,e){
                            switch(e[1]){
                                case "master":
                                    e[1] = "主";
                                    break;
                                case "slave":
                                    e[1] = "备";
                                    break;
                                case "alone":
                                    e[1] = "无";
                                    break;
                                default:
                                    e[1] = "";
                            }
                        });
                        fnCallback(data);
                    }
                });
                
            }*/
        });
    }
    
    // 刷新TCP流表数据
    function refreshTCPFlowTable(smart6, vName){
        
        // window.location.reload();
        if(fTable){
            fTable.fnDestroy();
        }
        
        // jquery.dataTables.js
        fTable = $('#flowTable').dataTable({
            "bSort": false,
            "bLengthChange": false,
            "bFilter": false,
            "language": {
                "url": "pages/Chinese.json"
            },
            "bProcessing": true,
//            "sAjaxSource": "ajax/flow.txt?smart6="+smart6,
            "sAjaxSource": "smart6/tcpsearch?smart6="+smart6 + "&vSmart6Name=" + vName,
            "aoColumns":[
                {"sTitle": "sipv6", "width": "30%"},
                {"sTitle": "dipv6", "width": "30%"},
                {"sTitle": "sport", "width": "13%"},
                {"sTitle": "dport", "width": "13%"},
                {"sTitle": "naptport", "width": "14%"}
            ]
        });
    }
    
    // 刷新UDP流表数据
    function refreshUDPFlowTable(smart6, vName){
        
        // window.location.reload();
        if(fTable){
            fTable.fnDestroy();
        }
        
        // jquery.dataTables.js
        fTable = $('#flowTable').dataTable({
            "bSort": false,
            "bLengthChange": false,
            "bFilter": false,
            "language": {
                "url": "pages/Chinese.json"
            },
            "bProcessing": true,
//            "sAjaxSource": "ajax/flow.txt?smart6="+smart6,
            "sAjaxSource": "smart6/udpsearch?smart6="+smart6 + "&vSmart6Name=" + vName,
            "aoColumns":[
                {"sTitle": "sipv6", "width": "30%"},
                {"sTitle": "dipv6", "width": "30%"},
                {"sTitle": "sport", "width": "13%"},
                {"sTitle": "dport", "width": "13%"},
                {"sTitle": "naptport", "width": "14%"}
            ]
        });
    }
    
    // 刷新userTB数据
    function refreshUserTBFlowTable(smart6, vName){
        
        // window.location.reload();
        if(fTable){
            fTable.fnDestroy();
        }
        
        // jquery.dataTables.js
        fTable = $('#flowTable').dataTable({
            "bSort": false,
            "bLengthChange": false,
            "bFilter": false,
            "language": {
                "url": "pages/Chinese.json"
            },
            "bProcessing": true,
//            "sAjaxSource": "ajax/flow.txt?smart6="+smart6,
            "sAjaxSource": "smart6/usertbsearch?smart6="+smart6 + "&vSmart6Name=" + vName,
            "aoColumns":[
                {"sTitle": "User_IPv6","width":"40%"},
                {"sTitle": "30%"},
                {"sTitle": "30%"}
            ]
        });
    }
    
    // 下发配置弹窗
    function config(name){
//        console.log(name);
        $("#configModal").modal("show");
        $('#configModal').on('shown.bs.modal', function (e) {
            $("#hvSmart6Name").val(name);
        });
    }
    
    // 下发配置提交
    function configSubmit(){
        var smart6 = $("#deviceSelect option:selected").val();
        var vSmart6Name = $("#hvSmart6Name").val();
        var config = {};
        config.vSmart6_name = vSmart6Name;
        config.v6lanip = $("#v6lanip").val();
        config.v6gateway = $("#v6gateway").val();
        config.v4wanip = $("#v4wanip").val();
        config.v4gateway = $("#v4gateway").val();
        config.prefA_Len = $("#prefA_Len").val();
        config.prefB_Len = $("#prefB_Len").val();
        config.prefA_feature = $("#prefA_feature").val();
        config.prefB_feature = $("#prefB_feature").val();
        config.prefA_nat_start = $("#prefA_nat_start").val();
        config.prefA_nat_end = $("#prefA_nat_end").val();
        config.Every_Start_Port = $("#Every_Start_Port").val();
        config.Port_Len = $("#Port_Len").val();
        config.Baddr_pool = $("#Baddr_pool").val();
        config.dns_proxy_mode = $("#dns_proxy_mode").val();
            $.ajax({
               url :"smart6/vsmart6Config",
               data:{smart6:smart6,config:JSON.stringify(config)},
               type:"POST",
               dataType:"JSON",
               success:function(data){
                   if(data == true){
                      alert("下发配置成功！");
                      $("#configModal").modal("hide");
                   }else{
                       alert("下发配置失败！");
                   }
               },
               error:function(e){
                   alert(e.message);
               }
            });
    }
    
    // 将vSmart6添加到备份组弹框
    function addToCluster(name){
//        console.log(name);
        $("#toClusterModal").modal("show");
        $('#toClusterModal').on('shown.bs.modal', function (e) {
            var smart6 = $("#deviceSelect option:selected").val();
            $("#hvSmart6Name2").val(name);
            // 获取备份组列表
            $.ajax({
               url:"smart6/clusterList?smart6=" + smart6 ,
//               url:"ajax/cluster.txt", 
               type:"GET",
               dataType:"json",
               success:function(data){
                   var clusterSrc = data.aaData;
                   var option = "";
                   $.each(clusterSrc,function(i,e){
                       option += '<option value = "' + e[0] + '">' + e[0] + '</option>';
                   });
                   $("#cluster").append(option);
               },
               errror:function(e){
                   alert(e);
               }
            });
        });
    }
    
    // 添加到备份组 提交
    function toClusterSubmit(){
        var vSmart6Name = $("#hvSmart6Name2").val();
        var cluster = $("#cluster option:selected").val();
        var smart6 = $("#deviceSelect option:selected").val();
//        console.log(vSmart6Name + "-" + cluster + "-" + smart6);
        $.ajax({
           url:"smart6/insertCluster",
           data:{smart6:smart6,clusterName:cluster,vSmart6Name:vSmart6Name},
           type:"POST",
           dataType:"json",
           success:function(data){
               if(data == true){
                   alert("添加成功！");
                   $("#toClusterModal").modal("hide");
               }else{
                   alert("添加失败！");
               }
           },
           error:function(e){
               alert(e);
           }
        });
    }
    
    // 初始化smart6 select选框
    function initSmart6s(){
        $.ajax({
            url :"smart6/smart6DeviceList",
//            url:"ajax/data.txt",
            type:"GET",
            dataType:"JSON",
            async:false,
            success:function(data){
                if(data){
                    var smartSrc = data.aaData;
                    var option = "";
                    $.each(smartSrc,function(i,e){
                        option += '<option value="' + e[0] + ',' + e[1] + '">' + e[0] + ':' + e[1] + '</option>';
                    });
                    $("#deviceSelect").append(option);
                }else{
                    $("#deviceSelect").append('<option value="">获取数据失败..</option>');
                }
            },
            error:function(e){
                alert(e.message);
            }
         });
    }
    
    // 生成vSmart6列表
    function vSmart6List(smart6){
        
        // window.location.reload();
        if(oTable){
            oTable.fnDestroy();
        }
        
        // jquery.dataTables.js
        oTable = $('#basicTable').dataTable({
            "bSort": false,
            "bLengthChange": false,
            "bFilter": false,
            "language": {
                "url": "pages/Chinese.json"
            },
            "bProcessing": true,
//            "sAjaxSource": "ajax/vsmart6.txt?smart6="+smart6,
            "sAjaxSource": "smart6/vsmart6List?smart6="+smart6,
            "aoColumns":[
                {"sTitle": "vSmart6","width":"160px"},
                {"sTitle": "状态"},
                {
                    "sTitle":"icmp",
                    "render":function(data,type,full,meta){
                        return '<a href="javascript:;" title="查看ICMP流表" onclick=\'viewFlow("' + full[0] + '", 1)\'><i class="fa fa-search"></i> </a>';
                    }
                },
                {
                    "sTitle":"tcp",
                    "render":function(data,type,full,meta){
                        return '<a href="javascript:;" title="查看TCP流表" onclick=\'viewFlow("' + full[0] + '", 2)\'><i class="fa fa-search"></i> </a>';
                    }
                },
                {
                    "sTitle":"udp",
                    "render":function(data,type,full,meta){
                        return '<a href="javascript:;" title="查看UDP流表" onclick=\'viewFlow("' + full[0] + '", 3)\'><i class="fa fa-search"></i> </a>';
                    }
                },
                {
                    "sTitle":"userTb",
                    "render":function(data,type,full,meta){
                        return '<a href="javascript:;" title="查看userTB" onclick=\'viewFlow("' + full[0] + '", 4)\'><i class="fa fa-search"></i> </a>';
                    }
                },
                {
                    "sTitle":"配置",
                    "render":function(data,type,full,meta){
                        return '<a href="javascript:;" title="查看配置" onclick=config("' + full[0] + '")><i class="fa fa-search"></i> </a>';
                    }
                },
                {
                    "sTitle": "操作",
                    "width":"100px",
                    "render": function(data,type,full,meta){
                        var name = full[0];
                        return '<a href="javascript:;" title="下发配置" onclick=config("' + name + '")><i class="fa fa-mail-forward"></i> </a>&nbsp;&nbsp;&nbsp;<a href="javascript:;" title="加入到备份组" onclick=addToCluster("' + name + '")><i class="fa fa-plus"></i> </a> &nbsp;&nbsp;&nbsp; <a href="javascript:;" title="删除" onclick=deletevSmart6("' + name + '")><i class="fa fa-trash-o"></i> </a>';
                    }
                }
            ],
            fnServerData:function(sUrl, aoData, fnCallback, oSettings){
                oSettings.jqXHR = $.ajax({
                    "url": sUrl,
//                    "data": aoData,
//                    "type":"POST",
                    "dataType": "json",
                    "cache": false,
                    "success": function(data){
                        $.each(data.aaData,function(i,e){
                            switch(e[1]){
                                case "master":
                                    e[1] = "主";
                                    break;
                                case "slave":
                                    e[1] = "备";
                                    break;
                                case "alone":
                                    e[1] = "无";
                                    break;
                                default:
                                    e[1] = "";
                            }
                        });
                        fnCallback(data);
                    }
                });
                
            }
        });
    }

    $(function() {
        initSmart6s();
        vSmart6List($("#deviceSelect option:selected").val());
        
        // smart6设备选择
        $("#deviceSelect").change(function(){
            var smart6 = $("#deviceSelect option:selected").val();
            vSmart6List(smart6);
        });
        
    });
    </script>
</body>


</html>
